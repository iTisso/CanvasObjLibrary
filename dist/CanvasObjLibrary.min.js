!function t(e,n,i){function o(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n?n:t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(t):"object"===("undefined"==typeof n?"undefined":r(n))?e.exports=t():(0,eval)("this").Mat=t()}(function(){function t(e){function r(t,n,i){var o=new e(t*n);return Object.setPrototypeOf(o,a),Object.defineProperty(o,"length",{value:t*n}),Object.defineProperty(o,"row",{value:t}),Object.defineProperty(o,"column",{value:n}),arguments.length>=3&&(a._instanceofTypedArray&&0===i||("number"==typeof i?o.fill(i):i.length&&o.set(i))),o}var a=function(){function t(){i(this,t)}return o(t,[{key:"length",get:function(){return this._len}}],[{key:"leftMultiply",value:function(t){return this.set(r.multiply(t,this,r.Matrixes.T3))}},{key:"rightMultiply",value:function(t){return this.set(r.multiply(this,t,r.Matrixes.T3))}},{key:"fill",value:function(t){arguments.length||(t=0);for(var e=this.length;e--;)this[e]=t;return this}},{key:"set",value:function(t,e){e||(e=0);for(var n=t.length+e<=this.length?t.length:this.length-e;n--;)this[e+n]=t[n];return this}},{key:"put",value:function(t,e,n){return r.put(this,t,e||0,n||0),this}},{key:"rotate2d",value:function(t){return this.set(r.rotate2d(this,t,r.Matrixes.T3))}},{key:"translate2d",value:function(t,e){return this.set(r.translate2d(this,t,e,r.Matrixes.T3))}},{key:"scale2d",value:function(t,e){return this.set(r.scale2d(this,t,e,r.Matrixes.T3))}},{key:"rotate3d",value:function(t,e,n){return this.set(r.rotate3d(this,t,e,n,r.Matrixes.T4))}},{key:"scale3d",value:function(t,e,n){return this.set(r.scale3d(this,t,e,n,r.Matrixes.T4))}},{key:"translate3d",value:function(t,e,n){return this.set(r.translate3d(this,t,e,n,r.Matrixes.T4))}},{key:"rotateX",value:function(t){return this.set(r.rotateX(this,t,r.Matrixes.T4))}},{key:"rotateY",value:function(t){return this.set(r.rotateY(this,t,r.Matrixes.T4))}},{key:"rotateZ",value:function(t){return this.set(r.rotateZ(this,t,r.Matrixes.T4))}},{key:"clone",value:function(){return r(this.row,this.column).set(this)}},{key:"toString",value:function(){if(0===this.length)return"";for(var t=0,e=[],n=[];t<this.length;t++)t&&t%this.column===0&&(e.push(n.join("\t")),n.length=0),n.push(this[t]||0);return e.push(n.join("\t")),e.join("\n")}}]),t}(),s=function(){function e(){i(this,e)}return o(e,null,[{key:"Identity",value:function(t){for(var e=r(t,t,0),n=t;n--;)e[n*t+n]=1;return e}},{key:"multiply",value:function(t,e,n){if(t.column!==e.row)throw"wrong matrix";for(var i=t.row,o=Math.min(t.column,e.column),a=n||r(i,o),s=void 0,u=void 0,h=void 0,l=i;l--;)for(s=o;s--;)for(a[h=l*a.column+s]=0,u=t.column;u--;)a[h]+=t[l*t.column+u]*e[s+u*e.column];return a}},{key:"multiplyString",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t.column!==e.row)throw"wrong matrix";var o,a,s,u,h=n||r(t.row,e.column);for(o=t.row;o--;)for(a=e.column;a--;)for(h[u=o*e.column+a]="",s=0;s<t.column;s++)(!i||0!=t[o*t.column+s]&&0!=e[a+s*e.column])&&(h[u]+=(s&&h[u]?"+":"")+"("+t[o*t.column+s]+")*("+e[a+s*e.column]+")");return h}},{key:"add",value:function(t,e,n){if(t.column!==e.column||t.row!==e.row)throw"wrong matrix";for(var i=n||r(t.row,e.column),o=t.length;o--;)i[o]=t[o]+e[o];return i}},{key:"minus",value:function(t,e,n){if(t.column!==e.column||t.row!==e.row)throw"wrong matrix";for(var i=n||r(t.row,e.column),o=t.length;o--;)i[o]=t[o]-e[o];return i}},{key:"rotate2d",value:function(t,e,n){var i=r.Matrixes.rotate2d;return i[0]=i[4]=Math.cos(e),i[1]=-(i[3]=Math.sin(e)),r.multiply(i,t,n||r(3,3))}},{key:"scale2d",value:function(t,e,n,i){var o=r.Matrixes.scale2d;return o[0]=e,o[4]=n,r.multiply(o,t,i||r(3,3))}},{key:"translate2d",value:function(t,e,n,i){var o=r.Matrixes.translate2d;return o[2]=e,o[5]=n,r.multiply(o,t,i||r(3,3))}},{key:"rotate3d",value:function(t,e,n,i,o){var a=Math.cos(e),s=Math.sin(e),u=Math.cos(n),h=Math.sin(n),l=Math.cos(i),c=Math.sin(i),f=r.Matrixes.rotate3d;return f[0]=l*u,f[1]=l*h*s-c*a,f[2]=l*h*a+c*s,f[4]=c*u,f[5]=c*h*s+l*a,f[6]=c*h*a-l*s,f[8]=-h,f[9]=u*s,f[10]=u*a,r.multiply(f,t,o||r(4,4))}},{key:"rotateX",value:function(t,e,n){var i=r.Matrixes.rotateX;return i[10]=i[5]=Math.cos(e),i[6]=-(i[9]=Math.sin(e)),r.multiply(i,t,n||r(4,4))}},{key:"rotateY",value:function(t,e,n){var i=r.Matrixes.rotateY;return i[10]=i[0]=Math.cos(e),i[8]=-(i[2]=Math.sin(e)),r.multiply(i,t,n||r(4,4))}},{key:"rotateZ",value:function(t,e,n){var i=r.Matrixes.rotateZ;return i[5]=i[0]=Math.cos(e),i[1]=-(i[4]=Math.sin(e)),r.multiply(i,t,n||r(4,4))}},{key:"scale3d",value:function(t,e,n,i,o){var a=r.Matrixes.scale3d;return a[0]=e,a[5]=n,a[10]=i,r.multiply(a,t,o||r(4,4))}},{key:"translate3d",value:function(t,e,n,i,o){var a=r.Matrixes.translate3d;return a[12]=e,a[13]=n,a[14]=i,r.multiply(a,t,o||r(4,4))}},{key:"put",value:function(t,e,n,i){var o=void 0;n||(n=0),i||(i=0);for(var r=e.row;r--;)if(!(r+n>=t.row))for(o=e.column;o--;)o+i>=t.column||(t[(r+n)*t.column+o+i]=e[r*e.column+o])}},{key:"createClass",value:function(e){return t(e)}}]),e}(),u=new e(1);return Object.defineProperty(a,"_instanceofTypedArray",{value:!(!n||!n.isPrototypeOf(u))}),u=null,Object.setPrototypeOf(a,e.prototype),Object.setPrototypeOf(r,s),r.Matrixes={I3:r.Identity(3),I4:r.Identity(4),T3:r(3,3,0),T4:r(4,4,0),rotate2d:r.Identity(3),translate2d:r.Identity(3),scale2d:r.Identity(3),translate3d:r.Identity(4),rotate3d:r.Identity(4),rotateX:r.Identity(4),rotateY:r.Identity(4),rotateZ:r.Identity(4),scale3d:r.Identity(4)},r}var e=(0,eval)("this"),n=e.Float32Array&&e.Float32Array.prototype;return t(e.Float32Array?Float32Array:Array)})},{}],2:[function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function n(){}function o(t,e){return function(){t.apply(e,arguments)}}function r(t){if("object"!==i(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function a(t,e){for(;3===t._state;)t=t._value;return 0===t._state?void t._deferreds.push(e):(t._handled=!0,void r._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?s:u)(e.promise,t._value);var i;try{i=n(t._value)}catch(t){return void u(e.promise,t)}s(e.promise,i)}))}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===("undefined"==typeof e?"undefined":i(e))||"function"==typeof e)){var n=e.then;if(e instanceof r)return t._state=3,t._value=e,void h(t);if("function"==typeof n)return void c(o(n,e),t)}t._state=1,t._value=e,h(t)}catch(e){u(t,e)}}function u(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&r._immediateFn(function(){t._handled||r._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function c(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}var f=setTimeout;r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){var i=new this.constructor(n);return a(this,new l(t,e,i)),i},r.all=function(t){var e=Array.prototype.slice.call(t);return new r(function(t,n){function o(a,s){try{if(s&&("object"===("undefined"==typeof s?"undefined":i(s))||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(t){o(a,t)},n)}e[a]=s,0===--r&&t(e)}catch(t){n(t)}}if(0===e.length)return t([]);for(var r=e.length,a=0;a<e.length;a++)o(a,e[a])})},r.resolve=function(t){return t&&"object"===("undefined"==typeof t?"undefined":i(t))&&t.constructor===r?t:new r(function(e){e(t)})},r.reject=function(t){return new r(function(e,n){n(t)})},r.race=function(t){return new r(function(e,n){for(var i=0,o=t.length;i<o;i++)t[i].then(e,n)})},r._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){f(t,0)},r._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},r._setImmediateFn=function(t){r._immediateFn=t},r._setUnhandledRejectionFn=function(t){r._unhandledRejectionFn=t},"undefined"!=typeof e&&e.exports?e.exports=r:t.Promise||(t.Promise=r)}(void 0)},{}],3:[function(t,e,n){(function(t,e){"use strict";!function(e,n){function i(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return p[v]=i,d(v),v++}function o(t){delete p[t]}function r(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}function a(t){if(m)setTimeout(a,0,t);else{var e=p[t];if(e){m=!0;try{r(e)}finally{o(t),m=!1}}}}function s(){d=function(e){t.nextTick(function(){a(e)})}}function u(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function h(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),d=function(n){e.postMessage(t+n,"*")}}function l(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;a(e)},d=function(e){t.port2.postMessage(e)}}function c(){var t=y.documentElement;d=function(e){var n=y.createElement("script");n.onreadystatechange=function(){a(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}function f(){d=function(t){setTimeout(a,0,t)}}if(!e.setImmediate){var d,v=1,p={},m=!1,y=e.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(e);g=g&&g.setTimeout?g:e,"[object process]"==={}.toString.call(e.process)?s():u()?h():e.MessageChannel?l():y&&"onreadystatechange"in y.createElement("script")?c():f(),g.setImmediate=i,g.clearImmediate=o}}("undefined"==typeof self?"undefined"==typeof e?void 0:e:self)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:6}],4:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in e)t.addEventListener(n,e[n])}Object.defineProperty(n,"__esModule",{value:!0}),n.requestIdleCallback=n.CanvasObjLibrary=void 0;var u=function(){function t(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();t("../lib/setImmediate/setImmediate.js");var l=t("../lib/promise/promise.js"),c=i(l),f=t("../lib/Mat/Mat.js"),d=i(f);window.Promise||(window.Promise=c.default);var v=Object.defineProperty,p=function(){function t(e){var n=this;if(a(this,t),e instanceof HTMLCanvasElement==!1)throw new TypeError("canvas required");Object.assign(this,{canvas:e,context:e.getContext("2d"),Matrix:d.default,default:{font:{fontStyle:null,fontWeight:null,fontVariant:null,color:"#000",textAlign:"start",lineHeight:null,fontSize:14,fontFamily:"Arial",strokeWidth:0,strokeColor:"#000",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,fill:!0,reverse:!1},style:{POSITIONMATRIX:1,ROTATEMATRIX:16,ZOOMMATRIX:256,width:1,height:1,hidden:!1,opacity:1,clipOverflow:!1,backgroundColor:null,composite:null,debugBorderColor:"black",x:0,y:0,positionPointX:0,positionPointY:0,zoomX:1,zoomY:1,zoomPointX:0,zoomPointY:0,rotate:0,rotatePointX:0,rotatePointY:0,_translateMat:d.default.Identity(3),_tempMat:d.default.Identity(3)}},stat:{mouse:{x:null,y:null,previousX:null,previousY:null},onfocus:null,onover:null,canvasOnFocus:!1,canvasOnover:!1},tmp:{graphID:0,onOverGraph:null,toClickGraph:null},root:null,class:{},autoClear:!0,debug:{switch:!1,count:0,frame:0,FPS:0,_lastFrameTime:Date.now(),on:function(){this.switch=!0},off:function(){this.switch=!1}}});for(var i in m)this.class[i]=m[i](this);this.root=new this.class.FunctionGraph,this.root.name="root",v(this.root,"parentNode",{configurable:!1}),this.adjustCanvas(),s(e,{mouseout:function(t){n.stat.canvasOnover=!1,n.stat.mouse.x=null,n.stat.mouse.y=null;n.stat.onover;n._commonEventHandle(t),n.stat.onover=null},mouseover:function(t){n.stat.canvasOnover=!0},mousemove:function(t){n.tmp.toClick=!1,n._commonEventHandle(t)},mousedown:function(t){n.tmp.toClickGraph=n.stat.onover,n.stat.canvasOnFocus=!0,n.stat.onfocus=n.stat.onover,n._commonEventHandle(t)},mouseup:function(t){return n._commonEventHandle(t)},click:function(t){n.tmp.toClickGraph&&n._commonEventHandle(t)},dblclick:function(t){return n._commonEventHandle(t)},selectstart:function(t){return t.preventDefault()},wheel:function(t){var e=new n.class.WheelEvent("wheel");e.origin=t,(n.stat.onover||n.root).emit(e)}}),s(document,{mousedown:function(t){t.target!==n.canvas&&(n.stat.canvasOnFocus=!1)},mouseout:function(t){if(null!==n.stat.mouse.x){var e=new window.MouseEvent("mouseout");n.canvas.dispatchEvent(e)}},keydown:function(t){return n._commonEventHandle(t)},keyup:function(t){return n._commonEventHandle(t)},keypress:function(t){return n._commonEventHandle(t)}})}return h(t,[{key:"generateGraphID",value:function(){return++this.tmp.graphID}},{key:"adjustCanvas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.canvas.offsetWidth,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvas.offsetHeight;this.root.style.width=this.canvas.width=t,this.root.style.height=this.canvas.height=e;var n=new this.class.Event("resize");this.root.emit(n)}},{key:"_commonEventHandle",value:function(t){if(t instanceof MouseEvent){this.stat.previousX=this.stat.mouse.x,this.stat.previousY=this.stat.mouse.y,"mouseout"===t.type?(this.stat.mouse.x=null,this.stat.mouse.y=null):(this.stat.mouse.x=t.layerX,this.stat.mouse.y=t.layerY);var e=new this.class.MouseEvent(t.type);e.origin=t,(this.stat.onover||this.root).emit(e)}else if(t instanceof KeyboardEvent){if(!this.stat.canvasOnFocus)return;var n=new this.class.KeyboardEvent(t.type);n.origin=t,(this.stat.onfocus||this.root).emit(n)}}},{key:"clear",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"draw",value:function(){this.debug.count=0,this.debug.frame++,this.autoClear&&this.clear(),this.traverseGraphTree(0),this.debug.switch&&this.drawDebug()}},{key:"traverseGraphTree",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.context.setTransform(1,0,0,1,0,0),this.drawGraph(this.root,t);var e=this.stat.onover;this.tmp.onOverGraph!==e&&(this.tmp.toClickGraph=null,this.stat.onover=this.tmp.onOverGraph,e&&e.emit(new this.class.MouseEvent("mouseout")),this.stat.onover&&this.stat.onover.emit(new this.class.MouseEvent("mouseover"))),this.tmp.onOverGraph=null}},{key:"drawDebug",value:function(){var t=this.context,e=this.debug,n=this.stat,i=Date.now(),o=this.stat.mouse.x,r=this.stat.mouse.y;e.FPS=1e3/(i-e._lastFrameTime)+.5|0,e._lastFrameTime=i,t.save(),t.beginPath(),t.setTransform(1,0,0,1,0,0),t.font="16px Arial",t.textBaseline="bottom",t.globalCompositeOperation="lighter",t.fillStyle="red",t.fillText("point:"+String(o)+","+String(r)+" FPS:"+e.FPS+" Items:"+e.count+" Frame:"+e.frame,0,this.canvas.height),t.fillText("onover:"+(n.onover?n.onover.GID:"null")+" onfocus:"+(n.onfocus?n.onfocus.GID:"null"),0,this.canvas.height-20),t.strokeStyle="red",t.globalCompositeOperation="source-over",t.moveTo(o,r+6),t.lineTo(o,r-6),t.moveTo(o-6,r),t.lineTo(o+6,r),t.stroke(),t.restore()}},{key:"drawGraph",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.style.hidden!==!0){var n=this.context,i=t.style,o=i._tempMat;this.debug.count++,n.save(),0===e&&(n.globalCompositeOperation=i.composite,n.globalAlpha=i.opacity),o.set(i.positionMatrix),i.beforeMatrix&&o.rightMultiply(i.beforeMatrix),i.rotate%360!==0&&o.rightMultiply(i.rotateMatrix),1===i.zoomX&&1===i.zoomY||o.rightMultiply(i.zoomMatrix),i.afterMatrix&&o.rightMultiply(i.afterMatrix),n.transform(o[0],o[3],o[1],o[4],o[2],o[5]),this.debug.switch&&0===e&&(n.save(),n.beginPath(),n.globalAlpha=.5,n.globalCompositeOperation="source-over",n.strokeStyle=i.debugBorderColor,n.strokeWidth=1.5,n.strokeRect(0,0,i.width,i.height),n.strokeWidth=1,n.globalAlpha=1,n.strokeStyle="green",n.strokeRect(i.positionPointX-5,i.positionPointY-5,10,10),n.strokeStyle="blue",n.strokeRect(i.rotatePointX-4,i.rotatePointX-4,8,8),n.strokeStyle="olive",n.strokeRect(i.zoomPointX-3,i.zoomPointX-3,6,6),n.strokeStyle="#6cf",n.strokeRect(i.skewPointX-2,i.skewPointX-2,4,4),n.restore()),i.clipOverflow&&(n.beginPath(),n.rect(0,0,i.width,i.height),n.clip()),0===e?t.drawer&&t.drawer(n):1===e&&t.checkIfOnOver(!0,e);for(var r=0;r<t.childNodes.length;r++)this.drawGraph(t.childNodes[r],e);n.restore()}}}]),t}(),m={Event:function(t){return function t(e){a(this,t),this.type=e,this.timeStamp=Date.now()}},GraphEvent:function(t){return function(t){function e(t){a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.propagation=!0,n.stoped=!1,n.target=null,n}return r(e,t),h(e,[{key:"stopPropagation",value:function(){this.propagation=!1}},{key:"stopImmediatePropagation",value:function(){this.stoped=!0}},{key:"altKey",get:function(){return this.origin.altKey}},{key:"ctrlKey",get:function(){return this.origin.ctrlKey}},{key:"metaKey",get:function(){return this.origin.metaKey}},{key:"shiftKey",get:function(){return this.origin.shiftKey}}]),e}(t.class.Event)},MouseEvent:function(t){return function(e){function n(){return a(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return r(n,e),h(n,[{key:"button",get:function(){return this.origin.button}},{key:"buttons",get:function(){return this.origin.buttons}},{key:"movementX",get:function(){return t.stat.mouse.x-t.stat.previousX}},{key:"movementY",get:function(){return t.stat.mouse.y-t.stat.previousY}}]),n}(t.class.GraphEvent)},WheelEvent:function(t){return function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),h(e,[{key:"deltaX",get:function(){return this.origin.deltaX}},{key:"deltaY",get:function(){return this.origin.deltaY}},{key:"deltaZ",get:function(){return this.origin.deltaZ}},{key:"deltaMode",get:function(){return this.origin.deltaMode}}]),e}(t.class.MouseEvent)},KeyboardEvent:function(t){return function(t){function e(){return a(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),h(e,[{key:"key",get:function(){return this.origin.key}},{key:"code",get:function(){return this.origin.code}},{key:"repeat",get:function(){return this.origin.repeat}},{key:"keyCode",get:function(){return this.origin.keyCode}},{key:"charCode",get:function(){return this.origin.charCode}},{key:"location",get:function(){return this.origin.location}}]),e}(t.class.GraphEvent)},GraphEventEmitter:function(t){return function(){function e(){a(this,e),this._events={}}return h(e,[{key:"emit",value:function(e){e instanceof t.class.Event!=!1&&(e.target=this,this._resolve(e))}},{key:"_resolve",value:function(t){if(t.type in this._events){var e=this._events[t.type];try{for(var n=0;n<e.length;n++)if(e[n].call(this,t),t.stoped)return}catch(t){console.error(t)}}t.propagation===!0&&this.parentNode&&this.parentNode._resolve(t)}},{key:"on",value:function(t,e){e instanceof Function&&(t in this._events||(this._events[t]=[]),this._events[t].push(e))}},{key:"removeEvent",value:function(t,e){if(t in this._events){if(1===arguments.length)return void delete this._events[t];var n=void 0;(n=this._events[t].indexOf(e)>=0)&&this._events[t].splice(n,1),0===this._events[t].length&&delete this._events[t]}}}]),e}()},GraphStyle:function(t){return function(){function e(n){a(this,e),n&&this.inhert(n)||(this.__proto__.__proto__=t.default.style),this.positionMatrix=d.default.Identity(3),this.zoomMatrix=d.default.Identity(3),this.rotateMatrix=d.default.Identity(3),this.beforeMatrix=null,this.afterMatrix=null}return h(e,[{key:"inhertGraph",value:function(e){if(!(e instanceof t.class.Graph))throw new TypeError("graph is not a Graph instance");return this.inhertStyle(e.style),!0}},{key:"inhertStyle",value:function(e){if(!(e instanceof t.class.GraphStyle))throw new TypeError("graph is not a Graph instance");return this.__proto__=e,!0}},{key:"inhert",value:function(e){return e instanceof t.class.Graph?(this.inhertGraph(e),!0):e instanceof t.class.GraphStyle&&(this.inhertStyle(e),!0)}},{key:"cancelInhert",value:function(){this.__proto__=Object.prototype}},{key:"getPoint",value:function(t){switch(t){case"center":return[this.width/2,this.height/2]}return[0,0]}},{key:"size",value:function(t,e){this.width=t,this.height=e}},{key:"position",value:function(t,e){this.x=t,this.y=e,this.calcMatrix(1)}},{key:"zoom",value:function(t,e){1==arguments.length?this.zoomX=this.zoomY=t:(this.zoomX=t,this.zoomY=e),this.calcMatrix(256)}},{key:"setRotate",value:function(t){this.rotate=t,this.calcMatrix(16)}},{key:"setRotatePoint",value:function(t,e){if(2==arguments.length)this.rotatePointX=t,this.rotatePointY=e;else if(1==arguments.length){var n=this.getPoint(t),i=u(n,2);this.rotatePointX=i[0],this.rotatePointY=i[1]}this.calcMatrix(16)}},{key:"setPositionPoint",value:function(t,e){if(2==arguments.length)this.positionPointX=t,this.positionPointY=e;else if(1==arguments.length){var n=this.getPoint(t),i=u(n,2);this.positionPointX=i[0],this.positionPointY=i[1]}this.calcMatrix(1)}},{key:"setZoomPoint",value:function(t,e){if(2==arguments.length)this.zoomPointX=t,this.zoomPointY=e;else if(1==arguments.length){var n=this.getPoint(t),i=u(n,2);this.zoomPointX=i[0],this.zoomPointY=i[1]}this.calcMatrix(256)}},{key:"calcMatrix",value:function(t){if(1===(1&t)&&(this.positionMatrix[2]=this.x-this.positionPointX,this.positionMatrix[5]=this.y-this.positionPointY),16===(16&t)){var e=this.rotateMatrix,n=Math.sin(.0174532925*this.rotate),i=Math.cos(.0174532925*this.rotate);e[4]=e[0]=i,e[1]=-(e[3]=n),e[2]=(1-i)*this.rotatePointX+n*this.rotatePointY,e[5]=(1-i)*this.rotatePointY-n*this.rotatePointX}if(256===(256&t)){var o=this.zoomMatrix;o[0]=this.zoomX,o[2]=(1-this.zoomX)*this.zoomPointX,o[4]=this.zoomY,o[5]=(1-this.zoomY)*this.zoomPointY}}}]),e}()},Graph:function(t){return function(e){function n(){a(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.host=t,e.GID=e.host.generateGraphID(),e.onoverCheck=!0,Object.defineProperties(e,{style:{value:new t.class.GraphStyle,configurable:!0},childNodes:{value:[]},parentNode:{value:void 0,configurable:!0}}),e}return r(n,e),h(n,[{key:"createShadow",value:function(){var e=Object.create(this);return e.GID=this.host.generateGraphID(),e.shadowParent=this,Object.defineProperties(e,{style:{value:new t.class.GraphStyle(this.style),configurable:!0},parentNode:{value:void 0,configurable:!0}}),e}},{key:"appendChild",value:function(e){if(!(e instanceof t.class.Graph))throw new TypeError("graph is not a Graph instance");if(e===this)throw new Error("can not add myself as a child");if(e.parentNode!==this)v(e,"parentNode",{value:this});else{var n=this.findChild(e);n>=0&&this.childNodes.splice(n,1)}this.childNodes.push(e)}},{key:"insertAfter",value:function(e){if(!(e instanceof t.class.Graph))throw new TypeError("graph is not a Graph instance");if(e===this)throw new Error("can not add myself as a child");var n=e.parentNode,i=void 0,o=void 0;if(!n)throw new Error("no parentNode");o=n.findChild(e),n!==this.parentNode?v(this,"parentNode",{value:n}):(i=n.findChild(this),i>=0&&n.childNodes.splice(i,1)),n.childNodes.splice(i<o?o:o+1,0,this)}},{key:"insertBefore",value:function(e){if(!(e instanceof t.class.Graph))throw new TypeError("graph is not a Graph instance");if(e===this)throw new Error("can not add myself as a child");var n=e.parentNode,i=void 0,o=void 0;if(!n)throw new Error("no parentNode");o=n.findChild(e),n!==this.parentNode?v(this,"parentNode",{value:n}):(i=n.findChild(this),i>=0&&n.childNodes.splice(i,1)),n.childNodes.splice(i<o?o-1:o,0,this)}},{key:"findChild",value:function(t){for(var e=this.childNodes.length;e--;)if(this.childNodes[e]===t)return e;return-1}},{key:"removeChild",value:function(t){var e=this.findChild(t);e<0||(this.childNodes.splice(e,1),v(this,"parentNode",{value:void 0}))}},{key:"checkIfOnOver",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.onoverCheck===!1||!this.hitRange)return!1;var n=this.host.stat.mouse;return null!==n.x&&(this===this.host.tmp.onOverGraph||(t&&this.hitRange(this.host.context),0===e&&this.host.debug.switch&&(this.host.context.save(),this.host.context.strokeStyle="yellow",this.host.context.stroke(),this.host.context.restore()),!!this.host.context.isPointInPath(n.x,n.y)&&(this.host.tmp.onOverGraph=this,!0)))}},{key:"delete",value:function(){this.parentNode&&this.parentNode.removeChild(this),this.host.stat.onover===this&&(this.host.stat.onover=null),this.host.stat.onfocus===this&&(this.host.stat.onfocus=null)}}]),n}(t.class.GraphEventEmitter)},FunctionGraph:function(t){return function(t){function e(t){a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t instanceof Function&&(n.drawer=t),n.style.debugBorderColor="#f00",n}return r(e,t),h(e,[{key:"drawer",value:function(t){this.checkIfOnOver(!0)}},{key:"hitRange",value:function(t){t.beginPath(),t.rect(0,0,this.style.width,this.style.height)}}]),e}(t.class.Graph)},ImageGraph:function(t){return function(t){function e(t){a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t&&n.use(t),n.useImageBitmap=!0,n.style.debugBorderColor="#0f0",n}return r(e,t),h(e,[{key:"use",value:function(t){var e=this;if(t instanceof Image)return this.image=t,t.complete?(this.resetStyleSize(),this._createBitmap()):t.addEventListener("load",function(t){e.resetStyleSize(),e._createBitmap()}),!0;if(t instanceof HTMLCanvasElement)return this.image=t,this.resetStyleSize(),!0;throw new TypeError("Wrong image type")}},{key:"_createBitmap",value:function(){var t=this;this.useImageBitmap&&"function"==typeof createImageBitmap&&createImageBitmap(this.image).then(function(e){t._bitmap&&t._bitmap.close(),t._bitmap=e})}},{key:"resetStyleSize",value:function(){this.style.width=this.width,this.style.height=this.height}},{key:"drawer",value:function(t){t.drawImage(this.useImageBitmap&&this._bitmap?this._bitmap:this.image,0,0),this.checkIfOnOver(!0)}},{key:"hitRange",value:function(t){t.beginPath(),t.rect(0,0,this.style.width,this.style.height)}},{key:"width",get:function(){return this.image instanceof Image?this.image.naturalWidth:this.image instanceof HTMLCanvasElement?this.image.width:0}},{key:"height",get:function(){return this.image instanceof Image?this.image.naturalHeight:this.image instanceof HTMLCanvasElement?this.image.height:0}}]),e}(t.class.FunctionGraph)},CanvasGraph:function(t){return function(t){function e(){a(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.image=document.createElement("canvas"),t.context=t.image.getContext("2d"),t.useImageBitmap=!1,t.autoClear=!0,t}return r(e,t),h(e,[{key:"draw",value:function(t){this.autoClear&&this.context.clearRect(0,0,this.width,this.height),t(this.context,this.canvas),this.useImageBitmap&&this._createBitmap()}},{key:"width",set:function(t){this.image.width=t}},{key:"height",set:function(t){this.image.height=t}}]),e}(t.class.ImageGraph)},TextGraph:function(t){return function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";a(this,n);var i=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i._fontString="",i._renderList=null,i.autoSize=!0,i.font=Object.create(t.default.font),i.realtimeRender=!1,i.useImageBitmap=!0,i.style.debugBorderColor="#00f",i.text=e,i._renderToCache=i._renderToCache.bind(i),v(i,"_cache",{configurable:!0}),i}return r(n,e),h(n,[{key:"prepare",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._cache||this.realtimeRender||v(this,"_cache",{value:document.createElement("canvas")});var e="";if(this.font.fontStyle&&(e=this.font.fontStyle),this.font.fontVariant&&(e=e+" "+this.font.fontVariant),this.font.fontWeight&&(e=e+" "+this.font.fontWeight),e=e+" "+this.font.fontSize+"px",this.font.fontFamily&&(e=e+" "+this.font.fontFamily),this._fontString=e,!this.realtimeRender){var n=this._cache,i=n.ctx2d||(n.ctx2d=n.getContext("2d"));if(i.font=e,this._renderList=this.text.split(/\n/g),this.estimatePadding=Math.max(this.font.shadowBlur+5+Math.max(Math.abs(this.font.shadowOffsetY),Math.abs(this.font.shadowOffsetX)),this.font.strokeWidth+3),this.autoSize){for(var o=0,r=void 0,a="number"==typeof this.font.lineHeigh?this.font.lineHeigh:this.font.fontSize,s=this._renderList.length;s--;)r=i.measureText(this._renderList[s]).width,r>o&&(o=r);n.width=(this.style.width=o)+2*this.estimatePadding,n.height=(this.style.height=this._renderList.length*a)+(a<this.font.fontSize?2*this.font.fontSize:0)+2*this.estimatePadding}else n.width=this.style.width,n.height=this.style.height;i.translate(this.estimatePadding,this.estimatePadding),t?y(this._renderToCache):this._renderToCache()}}},{key:"_renderToCache",value:function(){var t=this;this.render(this._cache.ctx2d),this.useImageBitmap&&"function"==typeof createImageBitmap&&createImageBitmap(this._cache).then(function(e){t._bitmap&&t._bitmap.close(),t._bitmap=e})}},{key:"render",value:function(t){if(this._renderList){t.save(),t.font=this._fontString,t.textBaseline="top",t.lineWidth=this.font.strokeWidth,t.fillStyle=this.font.color,t.strokeStyle=this.font.strokeColor,t.shadowBlur=this.font.shadowBlur,
t.shadowColor=this.font.shadowColor,t.shadowOffsetX=this.font.shadowOffsetX,t.shadowOffsetY=this.font.shadowOffsetY,t.textAlign=this.font.textAlign;var e="number"==typeof this.font.lineHeigh?this.font.lineHeigh:this.font.fontSize,n=void 0;switch(this.font.textAlign){case"left":case"start":n=0;break;case"center":n=this.style.width/2;break;case"right":case"end":n=this.style.width}for(var i=this._renderList.length;i--;)this.font.strokeWidth&&t.strokeText(this._renderList[i],n,e*i),this.font.fill&&t.fillText(this._renderList[i],n,e*i);t.restore()}}},{key:"drawer",value:function(t){this.realtimeRender?(this.checkIfOnOver(!0),this.render(t)):(this._cache||this.prepare(),t.drawImage(this.useImageBitmap&&this._bitmap?this._bitmap:this._cache,-this.estimatePadding,-this.estimatePadding),this.checkIfOnOver(!0))}},{key:"hitRange",value:function(t){t.beginPath(),t.rect(0,0,this.style.width,this.style.height)}}]),n}(t.class.FunctionGraph)}};"function"!=typeof Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var o in i)i.hasOwnProperty(o)&&(e[o]=i[o])}return e}),Float32Array.__proto__.from||!function(){var t=[];Float32Array.__proto__.from=function(e,n,i){var o=Float32Array.__proto__;if("function"!=typeof this)throw new TypeError("# is not a constructor");if(this.__proto__!==o)throw new TypeError("this is not a typed array.");if(n=n||function(t){return t},"function"!=typeof n)throw new TypeError("specified argument is not a function");if(e=Object(e),!e.length)return new this(0);t.length=0;for(var r=0;r<e.length;r++)t.push(e[r]);t=t.map(n,i);for(var a=new this(t.length),s=0;s<a.length;s++)a[s]=t[s];return a}}(),function(){if(!window.requestAnimationFrame){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n,i){var o=Date.now(),r=i||Math.max(0,1e3/60-(o-t));e(0);var a=window.setTimeout(function(){e(o+r)},r);return t=o+r,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}}();var y=window.requestIdleCallback||setImmediate;n.default=p,n.CanvasObjLibrary=p,n.requestIdleCallback=y},{"../lib/Mat/Mat.js":1,"../lib/promise/promise.js":2,"../lib/setImmediate/setImmediate.js":3}],5:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var o=t("./CanvasObjLibrary.js"),r=i(o);window.CanvasObjLibrary||(window.CanvasObjLibrary=r.default)},{"./CanvasObjLibrary.js":4}],6:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(t){if(f===clearTimeout)return clearTimeout(t);if((f===o||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function s(){m&&v&&(m=!1,v.length?p=v.concat(p):y=-1,p.length&&u())}function u(){if(!m){var t=r(s);m=!0;for(var e=p.length;e;){for(v=p,p=[];++y<e;)v&&v[y].run();y=-1,e=p.length}v=null,m=!1,a(t)}}function h(t,e){this.fun=t,this.array=e}function l(){}var c,f,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{f="function"==typeof clearTimeout?clearTimeout:o}catch(t){f=o}}();var v,p=[],m=!1,y=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new h(t,e)),1!==p.length||m||r(u)},h.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}]},{},[5]);